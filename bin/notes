#!/usr/bin/bash

# TODO: Allow subfolders to be wikis
# TODO: ENCRYPTION

# fuz	"$@"
# rg --files | makecache | fuzscope | filer
# rg --files --sortr accessed | fuzscope "$QUERY" | filer

DIR="$NOTES_DIR"

POSITIONAL=()
while [[ $# -gt 0 ]]
do
    key="$1"

    case $key in
        -d|--directory)
            DIR="$2"
            shift # past value
            shift
            ;;
        *)    # unknown option
            POSITIONAL+=("$1") # save it in an array for later
            shift # past argument
            ;;
    esac
done
set -- "${POSITIONAL[@]}" # restore positional parameters

cd "$DIR" || exit

# QUERY=""
if [ -n "$*" ]; then
	QUERY="-q $@"
else
    QUERY=""
fi

finder()
{
    # find . -type f -printf "%T+\t%P\n" | sort -r | awk -F $'\t' '{print $2}' 
    rg --files --sortr modified 
}

OUT=$(finder | fuzscope $QUERY )

while [ -n "$OUT" ]; do 
    # echo -e "$OUT" | filer
    echo -e "$OUT" | peek
    OUT=$(finder | fuzscope $QUERY )
done
